\section{PETSc Options}
\label{petscoption}

\subsection{2D}

\noindent
The petsc option to run 2D modes is default to superlu\_dist. You can add the following line on your "srun" command line
to change to to mumps:

\begin{verbatim}
-pc_factor_mat_solver_type mumps
\end{verbatim}

\subsection{3D}

\noindent
When running M3D-C1 in the 3D nonlinear mode, you need to include PETSc Options file.
There is a number ``8'' in the file below. It must be equal to the number of toroidal planes. It
should be changed whenever you change the number of toroidal planes in the C1input file. The recommended
{\it options\_bjacobi} file is as follows:

\begin{verbatim}
-pc_type bjacobi
-pc_bjacobi_blocks 8
    (for 8 toroidal planes should be equal to nplanes in C1input)
-sub_pc_type lu
-sub_pc_factor_mat_solver_package superlu_dist
    (can exchange mumps for superlu_dist)
-mat_superlu_dist_rowperm NOROWPERM (only needed for superlu_dist)
-mat_mumps_icntl_14 50 (only needed for mumps)
    (50 means 50% of memory increase when needed.
     Users can make it 100 or more if encountering a runtime memory issue.)
-sub_ksp_type preonly
-ksp_type fgmres
-ksp_gmres_restart 220
-ksp_rtol 1.e-9
-ksp_max_it 10000
-on_error_abort

-hard_pc_type bjacobi
-hard_pc_bjacobi_blocks 8
    (for 8 toroidal planesâ€¦should be equal to nplanes in C1input)
-hard_sub_pc_type lu
-hard_sub_pc_factor_mat_solver_type superlu_dist
    (can change mumps for superlu_dist)
-mat_superlu_dist_rowperm NOROWPERM
    (only needed for superlu_dist)
-mat_mumps_icntl_14 50
    (only needed for mumps.)
    (50 means 50% of memory increase when needed.
     Users can make it 100 or more if encountering a runtime memory issue.)
-hard_sub_ksp_type preonly
-hard_ksp_type lgmres
-hard_ksp_lgmres_argument 4
-hard_ksp_gmres_restart 220
-hard_ksp_rtol 1.e-9
-hard_ksp_max_it 10000
\end{verbatim}

\subsection{BGMG}
\noindent
BGMG serves as an additional layer built on top of the Block Jacobi (BJ) preconditioner to enhance solver performance, 
particularly for numerically challenging systems such as the velocity and temperature equations. 
To enable BGMG, replace the second part of the options in the last section file with the following lines:

\begin{verbatim}
-mgsolve 5 (5 is for velocity equation, 
            change 5 to 17 for temperature eqution, 
            or use -mgsolve 5,17 for both)

-hard_ksp_type fgmres
-hard_ksp_norm_type unpreconditioned
-hard_pc_type mg

-hard_mg_levels_ksp_type fgmres
-hard_mg_levels_pc_type bjacobi
-hard_mg_levels_sub_pc_type lu
-hard_mg_levels_sub_pc_factor_mat_solver_type superlu_dist
-hard_mg_levels_sub_ksp_type preonly

-hard_mg_coarse_ksp_type fgmres
-hard_mg_coarse_pc_type bjacobi
-hard_mg_coarse_sub_pc_type lu
-hard_mg_coarse_sub_pc_factor_mat_solver_type superlu_dist
-hard_mg_coarse_sub_ksp_type preonly
\end{verbatim}

\noindent
You can also get hint from 

\$M3DC1\_CODE\_DIR/unstructured/regtest/pellet/base/options\_bjacobi.type\_mg.

\subsection{More}

\noindent
More examples are in regtest/pellet/base/ directory, such as 

\begin{verbatim}
options_bjacobi.type_superludist
options_bjacobi.type_mumps 
\end{verbatim}

\noindent
The following are additional optional arguments:

\begin{verbatim}
-ksp_converged_reason
-ksp_view

-help

-options_table
-options_left

-trdump
-malloc_log
\end{verbatim}

for diagnosing purpose.
